import{V as A,a as M,t as q}from"./chunk-CFqxbShl.js";import{_ as I,a as N,b as R,c as z}from"./chunk-BJ42xXkR.js";import{S as j,g as E,b as L,p as O}from"./chunk-DTI1-tPr.js";import{d as B,p as d,at as G,au as H,P as J,s as K,a as F,o as w,F as $,b as f,g as Q,B as W,u as e,a7 as X,t as x,a4 as Y,e as C,v as Z,w as tt,av as et}from"./chunk-D9MUhhqC.js";import{T as n}from"./chunk-CntOc3u2.js";/* empty css              */import"./chunk-DgFy0AYB.js";import"./chunk-Db8R8jrI.js";/* empty css              */import"./chunk-Di9FnFMJ.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */const at={source:{type:String,default:""},textToSpeech:{type:Function,required:!0},modelUrl:{type:String,required:!0},datasetUrl:{type:String,required:!0},sourceUrl:{type:String,required:!0},status:{type:String,default:void 0},playAfterCache:{type:Number,default:100}},rt={"update:status":null},k=B({name:"VkMetahumanBroadcasting",inheritAttrs:!1,__name:"index",props:at,emits:rt,setup(p,{emit:s}){const o=p,y=s,i=d([]),c=new j(o.modelUrl),l=d([]),g=G([]),U=H(),u=J({default:n.pending,key:"status"},o,y),h=d(n.pending);K(async()=>{await c.when();const{blendingMaskBitmap:a,dataset:t,zipBlob:r,zip:v}=await E({datasetUrl:o.datasetUrl,sourceUrl:o.sourceUrl});V(t,v),await c.startStreaming({blendingMaskBitmap:a,dataset:t,zipBlob:r},{onFrame(m){l.value.push(m)},onProgress(m,S){(S<o.playAfterCache&&m===S||m===o.playAfterCache)&&(u.value=n.play)}}),U.resolve()});async function T(a){await c.when(),await U.promise;try{await O(a,{onChunkComplete(t){c.addChunk(t)}})}catch(t){console.error("音频处理错误:",t)}}async function D(a){if(a.blob)try{const t=await L(a.blob);await T(t)}catch(t){console.error("Error processing paragraph:",t)}}function P(){i.value.length&&(u.value=n.stop,l.value.length=0)}const _=d(!1);async function V(a,t){for(const r of a.images){const v=t.file(r.full_image);if(v){const m=await v.async("blob"),S=URL.createObjectURL(m);g.push(S)}h.value===n.pending&&(h.value=n.play)}_.value=!0}return(a,t)=>(w(),F($,null,[f(e(A),X(a.$attrs,{status:e(u),data:i.value,"text-to-speech":a.textToSpeech,source:a.source,processing:D,onSetData:t[0]||(t[0]=r=>e(x)(i.value,r)),onComplete:P}),null,16,["status","data","text-to-speech","source"]),f(e(I),{status:e(u),"onUpdate:status":t[1]||(t[1]=r=>Y(u)?u.value=r:null),data:l.value,onSetData:t[2]||(t[2]=r=>e(x)(l.value,r))},null,8,["status","data"]),_.value?(w(),Q(e(N),{key:0,status:h.value,"onUpdate:status":t[3]||(t[3]=r=>h.value=r),data:e(g),loop:!0,prerender:!0,visible:e(u)!==e(n).playing},null,8,["status","data","visible"])):W("",!0)],64))}});k.install=p=>{p.component(k.name||"VkMetahumanBroadcasting",k)};let b=null;async function st(p){return b||(b=M({access_token:"21c0f2a5067fb1cb"}).then(s=>{localStorage.setItem("accessToken",s),sessionStorage.setItem("accessToken",s)})),await b,q({application_id:"2c0946f4-02f0-11f0-b881-0242ac170002",text:p}).then(s=>s)}const ot={"h-450px":""},nt=`大自然里，草长莺飞，莺歌燕舞，她生活在一个美好的世界里。

然而，当她经过茧里的痛苦与挣扎，终于破茧而出时，却不是一只在空中轻盈飞舞的花蝴蝶，而是蜕变成为了一只灰色的小飞蛾。

在同伴的叹息中，她笑着流下了激动的泪水。`,Kt=B({__name:"basic",setup(p){et.path="/vunk-plus/sophontalk";const s="/vunk-plus/sophontalk/model.onnx",o="/vunk-plus/sophontalk/processed_images.zip",y="/vunk-plus/sophontalk/complete_dataset.json",i=d(n.pending);return(c,l)=>(w(),F($,null,[C("p",null,"当前状态: "+Z(i.value),1),f(e(z),null,{default:tt(()=>[f(e(k),{status:i.value,"onUpdate:status":l[0]||(l[0]=g=>i.value=g),"model-url":s,"source-url":o,"dataset-url":y,source:nt,"text-to-speech":e(st)},null,8,["status","text-to-speech"]),C("div",ot,[f(e(R),{"default-options":{background:"#FFF"}})])]),_:1})],64))}});export{Kt as default};
