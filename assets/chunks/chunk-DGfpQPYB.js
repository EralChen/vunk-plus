import{R}from"./chunk-Bif2z-0Z.js";import{d as L,S as M,r as c,U as P,W as O,X as k,L as A,R as W,c as _,o as E,p as j,h as S,a as s,t as U,Y as C,w as q,C as z,b as G,F as I}from"./chunk-DCqjOsLk.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-Db8R8jrI.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */const H={speenchToTextUrl:{type:String,default:"http://localhost:3000/speech-to-text"},onTextZone:{type:Function,default:void 0}},J={submitText:e=>typeof e=="string",submit:e=>!0};async function K(e,n){const u=new FormData;u.append("file",n,"audio.wav");const r=await fetch(e,{method:"POST",body:u});if(!r.ok)throw new Error("Speech to text failed");return(await r.json()).text}const Q=100,ee=L({name:"VkRecorderButton",components:{ElButton:M},props:H,emits:J,setup(e,{emit:n}){const u=c(!1),r=c(!1),m=c(),T=P(),a=c("");let B=null;const p=new R({type:"wav",sampleRate:16e3,bitRate:16,onProcess:Y}),Z=()=>new Promise((o,t)=>{p.open(()=>{u.value=!0,R.WaveView&&(T.value=R.WaveView({elem:m.value})),o(!0)},(i,l)=>{k.error(`${l?"用户未授权, ":""}无法录音:${i}`),t(new Error(i))})}),$=async()=>{await Z(),u.value&&(p.start(),r.value=!0)},d=c(!1),y=c({x:0,y:0}),v=c(!1),f=c(!1);let D=!1;const V=()=>{const o=f.value;p.stop(async t=>{a.value=(window.URL||webkitURL).createObjectURL(t),p.close(),r.value=!1,n("submit",{blob:t,url:a.value}),o&&(e.onTextZone?e.onTextZone({blob:t,url:a.value}):K(e.speenchToTextUrl,t).then(i=>{n("submitText",i)}).catch(i=>{console.error("语音识别错误:",i),k.error("转换文字失败")}))})},N=()=>{document.addEventListener("mousemove",x),document.addEventListener("mouseup",b)},F=()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",b)},X=o=>{o.preventDefault(),D=!0;const t="touches"in o?o.touches[0]:o;y.value={x:t.clientX,y:t.clientY},o instanceof MouseEvent&&N(),B=setTimeout(()=>{D&&(d.value=!0,$())},Q)};function x(o){if(o.preventDefault(),!d.value)return;const t="touches"in o?o.touches[0]:o;y.value={x:t.clientX,y:t.clientY};const i=document.querySelector(".cancel-btn"),l=document.querySelector(".text-btn");if(i&&l){const h=i.getBoundingClientRect(),g=l.getBoundingClientRect();v.value=t.clientX>=h.left&&t.clientX<=h.right&&t.clientY>=h.top&&t.clientY<=h.bottom,f.value=t.clientX>=g.left&&t.clientX<=g.right&&t.clientY>=g.top&&t.clientY<=g.bottom}}function b(o){D=!1,clearTimeout(B),d.value&&(v.value?p.close():V(),d.value=!1,v.value=!1,f.value=!1),o instanceof MouseEvent&&F()}function Y(o,t,i,l){T.value?.input(o[o.length-1],t,l)}return O(()=>{F()}),{onmousedown:X,onmousemove:x,onmouseup:b,recording:r,recordingNode:m,blobUrl:a,isDragging:d,cancelZone:v,isTextZone:f}}}),te={class:"sk-recorder-container"},oe={key:0,class:"recording-mask"},ne={class:"recording-tip"},se={ref:"recordingNode",class:"wave-container"},re={class:"tip-text"},ie={class:"action-buttons"};function ce(e,n,u,r,m,T){const a=W("ElButton");return E(),_("div",te,[e.isDragging?(E(),_("div",oe,[s("div",ne,[s("div",se,null,512),s("div",re,U(e.cancelZone?"松开手指，取消发送":"松开发送，上滑取消"),1)]),s("div",ie,[s("div",{class:C(["cancel-btn",{active:e.cancelZone}])},n[0]||(n[0]=[s("div",{class:"btn-icon"}," × ",-1),s("div",{class:"btn-text"}," 取消发送 ",-1)]),2),s("div",{class:C(["text-btn",{active:e.isTextZone}])},n[1]||(n[1]=[s("div",{class:"btn-icon"}," 文 ",-1),s("div",{class:"btn-text"}," 转为文字 ",-1)]),2)])])):j("",!0),S(a,z(e.$attrs,{class:["sk-recorder-button",{"is-recording":e.recording}],onTouchstart:e.onmousedown,onTouchmove:e.onmousemove,onTouchend:e.onmouseup,onMousedown:e.onmousedown}),{default:q(()=>n[2]||(n[2]=[s("span",{class:"sk-recorder-button-text"},"按住 说话",-1)])),_:1},16,["class","onTouchstart","onTouchmove","onTouchend","onMousedown"])])}const w=A(ee,[["render",ce]]);w.install=e=>{e.component(w.name||"VkRecorderButton",w)};const ue={"h-400px":""},Ae=L({__name:"basic",setup(e){const n=c("");function u(r){n.value=r}return(r,m)=>(E(),_(I,null,[s("div",ue,U(n.value),1),S(G(w),{onSubmitText:u})],64))}});export{Ae as default};
