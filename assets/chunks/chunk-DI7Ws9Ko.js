import{u as Z}from"./chunk-Bwm7c6SO.js";import{d as O,ag as M,r as u,E as V,aI as N,ap as P,a9 as U,A as X,B as E,Z as Y,b as $,g as j,v as A,C as n,ab as z,aw as R,T as q,_ as I,e as G}from"./chunk-yZy206vT.js";/* empty css              */import"./chunk-DucCsfaH.js";/* empty css              *//* empty css              */import"./chunk-Db8R8jrI.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */const H={onTextZone:{type:Function,default:void 0},appendTo:{type:null,default:"body"},disabled:{type:Boolean,default:!1},speechToText:{type:Function,default:void 0},submitToText:{type:Boolean,default:!1}},J={submitText:e=>typeof e=="string",submit:e=>!0,error:e=>!0};async function K(e,s){const a=new FormData;a.append("file",s,"audio.wav");const c=await fetch(e,{method:"POST",body:a});if(!c.ok)throw new Error("Speech to text failed");return(await c.json()).text}const Q=100,W=O({name:"VkRecorderButton",components:{ElButton:M},props:H,emits:J,setup(e,{emit:s}){const a=u(),{openOrStart:c,recording:l,recorder:d,wave:g}=Z({waveViewRef:a,defaultOptions:{onProcess:L}}),m=u("");let B=null;const i=u(!1),k=async()=>{try{await c({openThen:()=>(i.value=!1,!1)})}catch(o){console.error("录音失败:",o),s("error",o),i.value=!1;return}l.value=!0},y=u({x:0,y:0}),p=u(!1),v=u(!1);let b=!1;const F=()=>{const o=v.value;d.stop(async t=>{if(m.value=(window.URL||webkitURL).createObjectURL(t),d.close(),l.value=!1,s("submit",{blob:t,url:m.value}),o||e.submitToText)if(e.onTextZone)e.onTextZone({blob:t,url:m.value});else{if(e.speechToText){e.speechToText(t).then(r=>{s("submitText",r)});return}K("/speech-to-text",t).then(r=>{s("submitText",r)}).catch(r=>{console.error("语音识别错误:",r),N.error("转换文字失败")})}})},S=()=>{document.addEventListener("mousemove",x),document.addEventListener("mouseup",D)},_=()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",D)},C=o=>{if(e.disabled)return;o.preventDefault(),b=!0;const t="touches"in o?o.touches[0]:o;y.value={x:t.clientX,y:t.clientY},o instanceof MouseEvent&&S(),B=setTimeout(()=>{b&&(i.value=!0,k())},Q)};function x(o){if(o.preventDefault(),!i.value)return;const t="touches"in o?o.touches[0]:o;y.value={x:t.clientX,y:t.clientY};const r=document.querySelector(".cancel-btn-x"),f=document.querySelector(".text-btn-x");if(r&&f){const T=r.getBoundingClientRect(),h=f.getBoundingClientRect();p.value=t.clientX>=T.left&&t.clientX<=T.right&&t.clientY>=T.top&&t.clientY<=T.bottom,v.value=t.clientX>=h.left&&t.clientX<=h.right&&t.clientY>=h.top&&t.clientY<=h.bottom}}function D(o){b=!1,clearTimeout(B),i.value&&(p.value?d.close():F(),i.value=!1,p.value=!1,v.value=!1),o instanceof MouseEvent&&_()}function L(o,t,r,f){g.value?.input(o[o.length-1],t,f)}return V(()=>{_()}),{onmousedown:C,onmousemove:x,onmouseup:D,recording:l,recordingNode:a,blobUrl:m,isDragging:i,cancelZone:p,isTextZone:v}}}),ee={class:"vk-recorder-container"},te={class:"vk-recording-mask"},oe={class:"recording-tip"},ne={ref:"recordingNode",class:"wave-container"},se={class:"tip-text"},re={class:"action-buttons"},ie={class:"cancel-btn-x"},ae={class:"text-btn-x"};function ue(e,s,a,c,l,d){const g=U("ElButton");return E(),X("div",ee,[(E(),Y(q,{to:e.appendTo},[j(n("div",te,[n("div",oe,[n("div",ne,null,512),n("div",se,z(e.cancelZone?"松开手指，取消发送":"松开发送，上滑取消"),1)]),n("div",re,[n("div",ie,[n("div",{class:R(["cancel-btn",{active:e.cancelZone}])},s[0]||(s[0]=[n("div",{class:"btn-icon"}," × ",-1),n("div",{class:"btn-text"}," 取消发送 ",-1)]),2)]),n("div",ae,[n("div",{class:R(["text-btn",{active:e.isTextZone}])},s[1]||(s[1]=[n("div",{class:"btn-icon"}," 文 ",-1),n("div",{class:"btn-text"}," 转为文字 ",-1)]),2)])])],512),[[A,e.isDragging]])],8,["to"])),$(g,G(e.$attrs,{disabled:e.disabled,class:["vk-recorder-button",{"is-recording":e.recording}],size:"large",onTouchstart:e.onmousedown,onTouchmove:e.onmousemove,onTouchend:e.onmouseup,onMousedown:e.onmousedown}),{default:I(()=>s[2]||(s[2]=[n("span",{class:"vk-recorder-button-text"},"按住 说话",-1)])),_:1},16,["disabled","class","onTouchstart","onTouchmove","onTouchend","onMousedown"])])}const w=P(W,[["render",ue]]),je=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));w.install=e=>{e.component(w.name||"VkRecorderButton",w)};export{w as VkRecorderButton,je as __VkRecorderButton,w as default};
