import{a as U,l as W,o as x,s as z,c as D,E as M,b as P,d as R}from"./chunk-DliHrFMw.js";import{a as j,_ as q,b as I}from"./chunk-C_ajVg8n.js";import{d as N,p as O,aa as S,c as F,a as y,o as d,e as m,b as r,Q as k,g as V,B as g,w as l,u as s,f as J,v as C,S as $,a3 as L,a1 as Q,a2 as A,D as G,ab as H}from"./chunk-D9MUhhqC.js";/* empty css              */import{_ as K}from"./chunk-C097Egqz.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-Db8R8jrI.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */class X{constructor(){this.views=[]}getViews(){return this.views}createView(a){this.views.push(a)}upsertView(a,t={}){let n=this.getLastUpdatingView(a.type);return n?(n.content+=a.content,n.updating=a.updating,t.onUpdate?.(n)):(n=a,this.createView(n),t.onCreate?.(n)),n}getPrevView(a){const t=this.views.indexOf(a);if(t>0)return this.views[t-1]}getLastUpdatingView(a){return this.views.findLast(t=>t.updating&&t.type===a)}allViewUpdated(){this.views.forEach(a=>{a.updating=!1})}}const Y=["disabled"],Z={class:"status-icon"},tt={class:"label"},et={class:"content"},nt={class:"error-message"},at=N({__name:"index",props:{modelValue:{type:Boolean,default:!0},content:{default:""},status:{default:"start"},disabled:{type:Boolean,default:!1},autoCollapse:{type:Boolean,default:!1},duration:{default:"0.2s"},buttonWidth:{default:"160px"},maxWidth:{default:"500px"},backgroundColor:{default:"#fcfcfc"},color:{default:"var(--el-color-info)"}},emits:["change","update:modelValue"],setup(h,{emit:a}){const t=h,n=a,o=O(t.modelValue);S(()=>t.modelValue,e=>{o.value=e});function u(){t.disabled||(o.value=!o.value,n("change",{value:o.value,status:t.status}),n("update:modelValue",o.value))}const i=F(()=>t.status==="error"?"思考过程中出现错误":t.content);return S(()=>t.status,e=>{e==="end"&&t.autoCollapse&&(o.value=!1,n("update:modelValue",o.value))}),(e,B)=>{const c=M;return d(),y("div",{class:"el-thinking",style:G({"--el-thinking-button-width":t.buttonWidth,"--el-thinking-animation-duration":t.duration,"--el-thinking-content-wrapper-width":t.maxWidth,"--el-thinking-content-wrapper-background-color":t.backgroundColor,"--el-thinking-content-wrapper-color":t.color})},[m("button",{class:$(["trigger",[e.status,{disabled:!t.disabled}]]),disabled:t.disabled,onClick:u},[m("span",Z,[k(e.$slots,"status-icon",{status:t.status},()=>[e.status==="thinking"?(d(),V(c,{key:0,class:"is-loading el-icon-center"},{default:l(()=>[r(s(W))]),_:1})):g("",!0),e.status==="start"?(d(),V(c,{key:1,class:"el-icon-center start-color"},{default:l(()=>[r(s(x))]),_:1})):g("",!0),e.status==="end"?(d(),V(c,{key:2,class:"el-icon-center end-color"},{default:l(()=>[r(s(z))]),_:1})):g("",!0),e.status==="error"?(d(),V(c,{key:3,class:"el-icon-center error-color"},{default:l(()=>[r(s(D))]),_:1})):g("",!0)],!0)]),m("span",tt,[k(e.$slots,"label",{status:t.status},()=>[J(C(e.status==="thinking"?"思考中...":e.status==="error"?"思考遇到问题":e.status==="end"?"思考完成":"开始思考"),1)],!0)]),r(L,{name:"rotate"},{default:l(()=>[t.disabled?g("",!0):(d(),y("span",{key:0,class:$(["arrow el-icon-center",{expanded:s(o)}])},[k(e.$slots,"arrow",{},()=>[r(c,{class:"el-icon-center"},{default:l(()=>[r(s(P))]),_:1})],!0)],2))]),_:3})],10,Y),r(L,{name:"slide"},{default:l(()=>[s(i)?Q((d(),y("div",{key:0,class:$(["content-wrapper",{"error-state":e.status==="error"}])},[m("div",et,[e.status!=="error"?k(e.$slots,"content",{key:0,content:s(i)},()=>[m("pre",null,C(s(i)),1)],!0):k(e.$slots,"error",{key:1,errorContent:s(i)},()=>[m("div",nt,C(s(i)),1)],!0)])],2)),[[A,s(o)]]):g("",!0)]),_:3})],4)}}}),st=U(at,[["__scopeId","data-v-059ddb88"]]);async function ot(h,a){return H.reader({url:"/application/chat_message/d72c0954-819e-11f0-8636-062fece26b16",onmessage:h},{headers:{authorization:"application-9888ea942ed566bce1f7dc8cba294b46"},data:a})}const Gt=N({__name:"index",setup(h){const a=({message:n},{onSuccess:o,onError:u,onUpdate:i})=>{if(!n?.content)return;const e=[],B="assistant";let c=!0,E=!1;const p=new X;b(),ot(_=>{let f={content:"",reasoning_content:""};if(typeof _.data=="string")try{f=JSON.parse(_.data)}catch(w){u(w)}f.reasoning_content&&(c=!1,p.upsertView({content:f.reasoning_content,type:"thinking",updating:!0},{onCreate(w){const v=p.getPrevView(w);v&&(v.updating=!1)}}),b()),f.content&&(c=!1,p.upsertView({content:f.content,type:"text",updating:!0},{onCreate(w){const v=p.getPrevView(w);v&&(v.updating=!1)}}),b()),f.is_end&&(E=!0,p.allViewUpdated(),b(),T())},{message:n.content});function b(){const _={role:B,seviceLoading:c,seviceEnd:E,views:p.getViews()};i(_),e.push(_)}function T(){o(e)}},t=n=>{const o=n.views;let u=n.content??"";return o&&(u=o.reduce((i,e)=>(e.type==="thinking"?i+=[`:::thinking ${e.updating?"thinking":"end"}`,"```md",e.content,"```",":::"].join(`
`):i+=`
${e.content}`,i),"")),{role:n.role??"assistant",loading:n.seviceLoading===!0,content:u}};return(n,o)=>(d(),V(s(R),{request:a,parser:t},{default:l(()=>[r(s(j),null,{default:l(()=>[r(s(q)),r(s(I),{type:"container:thinking"},{default:l(({raw:u})=>[r(s(st),{content:u.children[0].content,status:u.open.info.split(" ")[1]||"thinking"},null,8,["content","status"])]),_:1}),r(K)]),_:1})]),_:1}))}});export{Gt as default};
