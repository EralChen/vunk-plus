import{a as _,t as w,b as B}from"./chunk-Bxndx4wn.js";import{d as D,r as c,c as C,a8 as T,q as U,H as V,j as F,a9 as N,A as j,B as E,b as n,C as d,h as i,aa as L,I as m,_ as f,ab as I,F as J,ac as O}from"./chunk-Cl7Gad5t.js";import{P as R,V as q}from"./chunk-CL9Aai7-.js";import{V as A}from"./chunk-CRQONH7Y.js";import{c as l}from"./chunk-DucCsfaH.js";import{T as o}from"./chunk-CntOc3u2.js";/* empty css              *//* empty css              */import"./chunk-Db8R8jrI.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-CbOvwASs.js";/* empty css              *//* empty css              */const H={"h-600px":"","w-400px":""},M=`大自然里，草长莺飞，莺歌燕舞，她生活在一个美好的世界里。

然而，当她经过茧里的痛苦与挣扎，终于破茧而出时，却不是一只在空中轻盈飞舞的花蝴蝶，而是蜕变成为了一只灰色的小飞蛾。

在同伴的叹息中，她笑着流下了激动的泪水。`,Vt=D({__name:"metahuman-broadcasting",setup(W){const g=_({access_token:"859436e6e5fe3e63"}).then(t=>{localStorage.setItem("accessToken",t)}),v=async t=>(await g,w({application_id:"1df6fc34-0483-11f0-ab5c-8e5d3c122c24",text:t}).then(a=>B(a))),e=c(o.pending),s=c([]),h=C(()=>s.value.some(t=>t.status===R.pending&&t.broadcast!==o.playing)),{data:y,send:b,close:x}=T("ws://localhost:8001/ws",{autoReconnect:!0});U(()=>{x()});const r=V([]);F(()=>{const t=JSON.parse(y.value);if(t){if(t.type==="frame"){const a=`data:image/jpeg;base64,${t.frame_data}`;r.push(a),l.info("Frame Data",t,r.length);return}if(t.type==="progress"&&t.frame===120||t.type==="streaming_complete"){if(e.value===o.playing||r.length===0)return;(e.value===o.pending||e.value===o.stopped||h.value)&&(e.value=o.play)}}});function k(t){if(!t.url)return;const a={mode:"start_from_position",audio_data:t.url.split(",").slice(1).join()};l.info("Processing Paragraph",a),b(JSON.stringify(a))}function S({data:t}){e.value!==o.playing&&(t.broadcast=o.pause,O(()=>e.value===o.playing,10,2e3).then(()=>{l.info("Broadcast Play",Date.now()),t.broadcast=o.play}))}function P(t){t&&s.value.length&&(e.value=o.stop,r.length=0)}return(t,a)=>{const u=N("ElButton");return E(),j(J,null,[n(i(q),{data:s.value,"text-to-speech":v,source:M,processing:k,onSetData:a[0]||(a[0]=p=>i(L)(s.value,p)),onParagraphLoad:S,"onUpdate:completed":P},null,8,["data"]),d("p",null,[n(u,{onClick:a[1]||(a[1]=()=>console.log(s.value))},{default:f(()=>a[4]||(a[4]=[m(" paragraphData ")])),_:1}),m(" "+I(e.value)+" ",1),n(u,{onClick:a[2]||(a[2]=()=>console.log(r))},{default:f(()=>a[5]||(a[5]=[m(" frameUrls ")])),_:1})]),d("div",H,[n(i(A),{status:e.value,"onUpdate:status":a[3]||(a[3]=p=>e.value=p),data:r},null,8,["status","data"])])],64)}}});export{Vt as default};
